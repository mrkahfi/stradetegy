{% extends 'JariffProjectBundle::base_search_new.html.twig' %}
{% form_theme form 'JariffProjectBundle:Themes:bootstrap_3_horizontal_layout_st_search.html.twig' %}
    {% form_theme formCustom 'JariffProjectBundle:Themes:bootstrap_3_horizontal_layout.html.twig' %}
        {% form_theme formCustomCountry 'JariffProjectBundle:Themes:bootstrap_3_horizontal_layout.html.twig' %}
            {% form_theme formFieldUsCustom 'JariffProjectBundle:Themes:bootstrap_3_horizontal_layout_st_search.html.twig' %}
                {% form_theme formDateRange 'JariffProjectBundle:Themes:bootstrap_3_horizontal_layout_st_search_date_range.html.twig' %}

                    {% block css_page %}style="overflow:visible"{% endblock %}
                        {% block menu %}
                        {% endblock %}

                        {% block navbar_search %}
                            {#<div class="navbar navbar-primary navbar-fixed-side navbar-fixed-side-left"#}
                            {#role="navigation"#}
                            {#style="margin-top: 23%">#}
                            {#<div class="container">#}
                            {#<div class="navbar-header">#}
                            {#<button type="button" class="navbar-toggle" data-toggle="collapse"#}
                            {#data-target=".navbar-collapse">#}
                            {#<span class="sr-only">Toggle navigation</span>#}
                            {#<span class="icon-bar"></span>#}
                            {#<span class="icon-bar"></span>#}
                            {#<span class="icon-bar"></span>#}
                            {#</button>#}
                            {#</div>#}
                            {#<div class="navbar-collapse collapse">#}

                            {#<ul class="nav navbar-nav st-nav">#}
                            {#<li class="active"><a href="#" data-toggle="modal"#}
                            {#data-target="#modalIntervalMonth"#}
                            {#><span class="icon-calendar3"></span> </a>#}
                            {#</li>#}
                            {#<li><a href="#" data-toggle="modal" class="j-show-blc"#}
                            {#data-target="#modalSave"><span#}
                            {#class="icon-list-ol"></span></a></li>#}
                            {#&#123;&#35;<li><a href="#"><span class="icon-list-ol"></span></a></li>&#35;&#125;#}

                            {#</ul>#}
                            {#</div>#}
                            {#<!--/.nav-collapse -->#}
                            {#</div>#}
                            {#</div>#}
                        {% endblock %}

                        {% block content %}
                            {% include "@JariffMember/Search/Shipments/Add/Form/loading.html.twig" %}

                            <div class="modal fade bs-example-modal-lg" id="myModal" tabindex="-1" role="dialog"
                            aria-labelledby="myModalLabel"
                            aria-hidden="true">
                            <div class="modal-dialog modal-lg">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <img src="{{ asset('/bundles/jariffproject/frontend/images/logo.png') }}"
                                        alt="stradetegy Logo">
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                            aria-hidden="true">&times;</span></button>
                                            <h4 class="modal-title j-modal-title" id="myModalLabel">Modal title</h4>
                                        </div>
                                        <div class="modal-body show-shipments-one">
                                            <div class="css3-spinner">
                                                <div class="css3-spinner-bounce1"></div>
                                                <div class="css3-spinner-bounce2"></div>
                                                <div class="css3-spinner-bounce3"></div>
                                            </div>

                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-default" data-dismiss="modal">Close
                                            </button>

                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="modal fade" id="modalSave" tabindex="-1" role="dialog"
                            aria-labelledby="exampleModalLabel"
                            aria-hidden="true" backdrop="static">
                            <div class="modal-dialog modal-lg">
                                <div class="modal-content st-content">

                                    <div class="modal-body">
                                        <div class="css3-spinner">
                                            <div class="css3-spinner-bounce1"></div>
                                            <div class="css3-spinner-bounce2"></div>
                                            <div class="css3-spinner-bounce3"></div>
                                        </div>
                                    </div>


                                </div>
                            </div>
                        </div>

                        <div class="modal fade bs-modal-field" id="myModalField" tabindex="-1" role="dialog"
                        aria-labelledby="myModalLabelField" aria-hidden="true">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                        aria-hidden="true">&times;</span></button>
                                        <h4 class="modal-title" id="myModalLabel">Your Selected Field</h4>
                                    </div>
                                    <div class="modal-body">
                                        <div style="clear: both"></div>
                                        {#<form action="{{ path('member_search_columns_category_submit',{'s_cache' : app.request.get('s_cache')}) }}"#}
                                        {#method="POST">#}

                                        {#{{ form_widget(formFieldUsCustom) }}#}



                                        {#<div class="form-group">#}
                                        {#<input type="submit"#}
                                        {#class="button button-search j-tour-button-submit pull-right"#}
                                        {#value="Apply Columns">#}

                                        {#</div>#}

                                        {#</form>#}

                                        <div style="clear: both"></div>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-default" data-dismiss="modal">Close
                                        </button>

                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="modal fade" id="modalIntervalMonth" tabindex="-1" role="dialog"
                        aria-labelledby="exampleModalLabel"
                        aria-hidden="true">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-body st-chart">
                                <div id="chart_div">
                                    {#<div class="css3-spinner">#}
                                    {#<div class="css3-spinner-bounce1"></div>#}
                                    {#<div class="css3-spinner-bounce2"></div>#}
                                    {#<div class="css3-spinner-bounce3"></div>#}
                                    {#</div>#}
                                </div>
                            </div>
                        </div>
                    </div>



                    <div class="pull-right" style="margin-bottom:15px">
                        <a href="javascript:void(0)" class="btn btn-default btn-sm j-search-again"
                        role="button">Search</a>

                        <div class="btn-group">
                            <button type="button" data-toggle="modal"
                            class="btn btn-default btn-sm j-modal-save"
                            data-target="#modalSave" data-backdrop="static">
                            Save Search
                        </button>

                    </div>
                    <div class="btn-group">
                        <a href="javascript:void(0)" type="button"
                        class="btn btn-sm btn-default j-modal-field-new"
                        {#data-toggle="modal"#}
                        {#data-target="#modalSave" data-backdrop="static"#}
                        >
                        Modify Display Fields
                    </a>

                </div>

                <a href="#" data-toggle="modal" class="j-modal-exports btn btn-sm btn-default"
                data-target="#modalSave" data-backdrop="static">Export/Email
                Report</a>

                {#<a href="#" data-toggle="modal" data-target="#modalSave" data-backdrop="static"#}
                {#class="j-modal-contact-company btn btn-default btn-sm" role="button">Contact#}
                {#Company</a>#}
            </div>
            <div class="clearfix"></div>

            <div class="j-form-change">
                <form action="{{ path('member_search_shipments_submit') }}" method="POST" class="">

                    <label class="col-sm-12 control-label required">Choose Date Range: </label>

                    {#<div class="form-inline">#}
                    {#<div class="form-group">#}
                    {#<label class="sr-only" for="dpd1">From</label>#}
                    {#<input type="text" class="form-control" id="dpd1" placeholder="From">#}
                    {#</div>#}
                    {#<div class="form-group">#}
                    {#<label class="sr-only" for="dpd2">To</label>#}
                    {#<input type="text" class="form-control" id="dpd2" placeholder="To">#}
                    {#</div>#}

                    {#</div>#}



                    {{ form_widget(formDateRange) }}
                    <br/>
                    <br/>
                    <br/>

                    <div style="clear: both"></div>
                    {{ form_widget(formCustom) }}
                    <div style="clear: both"></div>
                    {{ form_widget(formCustomCountry) }}
                    {#<div style="clear: both"></div>#}
                    {#{{ form_widget(formCustom) }}#}

                    <div style="clear: both"></div>

                    {{ form_start(form) }}

                    {% set pro = form_widget(form.condition.vars.prototype)|e ~ form_widget(form.collect.vars.prototype)|e ~ form_widget(form.q.vars.prototype)|e %}

                        <div class="j-show" data-prototype='{{ pro|raw }}'>


                            {% for i in 0..(form.collect|length-1) %}

                                {% if(i == 0) %}
                                    {{ form_widget(form.collect[i]) }}
                                    {{ form_widget(form.q[i]) }}
                                    {#<div class="form-group">#}
                                    {#<div class="col-md-1">#}
                                    {#<input type="submit" class="button button-search j-tour-button-submit" value="Search">#}

                                    {#</div>#}
                                    {#</div>#}
                                    <button type="submit" class="btn col-md-1 btn-primary">Search</button>

                                {% endif %}

                                {% if i > 0 %}
                                    {% if form.condition[i-1] is defined %}
                                        <div style="clear: both"></div>
                                        <div class="j-is-remove">

                                            {{ form_widget(form.condition[i-1]) }}

                                            {{ form_widget(form.collect[i]) }}
                                            {{ form_widget(form.q[i]) }}



                                            <div class="form-group">
                                                <div class="col-md-1"><a href="javascript:void(0)"
                                                   class="j-different-remove-shows btn btn-danger"
                                                   style="font-size: 16px;"
                                                   title="Delete This Filter"> <span
                                                   class="glyphicon glyphicon-remove"
                                                   aria-hidden="true"></span> remove </a></div>
                                               </div>

                                           {% endif %}
                                       {% endif %}
                                   {% endfor %}

                                   <div class="j-add-filter"></div>
                               </div>
                           </div>
                           {{ form_end(form) }}

                       </form>
                   </div>

                   <div class="alert alert-info">
                    {% set search = query_search|decrypted_query|jsondecode %}

                        Your search of Data for :


                        {% if search.search is defined %}
                            {% for key in search.search %}

                                {% if key.condition is not empty %}

                                    {{ key.condition|upper }}
                                {% endif %}

                                {% if  key.collect == 'buyers' or  key.collect == 'suppliers' or  key.collect == 'logistics' %}

                                    {% else %}
                                    {#{% if detail[key.collect] is defined %}#}
                                    {#{{ detail[key.collect] }}#}
                                    {#{% else %}#}
                                    {{ key.collect|globalfield(search.type.custom_country~'_'~search.type.custom_data) }}
                                    {#{% endif %}#}
                                {% endif %}
                                <a href="javascript:void(0)" class="j-popover-q label label-danger"
                                data-container="body" data-toggle="popover" data-trigger="focus"
                                data-placement="bottom">{{ key.q }}</a>

                            {% endfor %}


                            {% if search.country is defined %}
                                And Filter by Countries
                                {% for key in search.country %}
                                    {{ key|twolettercodecountry|capitalize }},
                                {% endfor %}

                            {% endif %}
                        {% endif %}

                        generated <span class="j-total-row"></span> results in <span class="j-took"></span>
                        seconds.
                    </div>

                    <div id="page">
                        <table id="jqGrid" style="width: 800px"></table>
                        <div id="jqGridPager"></div>

                    </div>

                    <div id="page-unvalid-date">

                    </div>

                    <div id="popover_content_wrapper" style="display: none">
                        <div>
                            <img src="{{ asset('/bundles/jariffproject/frontend/images/logo.png') }}"><br/>

                            <h3>Get multiple <span class="j-data-q label label-danger"></span> quotes</h3>

                            <p>Receive quotes from verified with one simple request.</p>
                            <hr/>
                            <button type="button" class="btn btn-warning j-popover-btn">Try it now</button>
                            <button type="button" class="btn btn-default j-popover-btn">Skip</button>
                            <button type="button" class="btn btn-default j-popover-btn">Never</button>
                        </div>
                    </div>

                {% endblock %}

                {% block style %}
                  <link rel="stylesheet" type="text/css" media="screen"
                  href="{{ asset('/bundles/jariffproject/frontend/jqgrid/css/ui.jqgrid-bootstrap.css') }}"/>
                  <link rel="stylesheet" type="text/css" media="screen"
                  href="{{ asset('/bundles/jariffproject/frontend/jqgrid/plugins/ui.multiselect.css') }}"/>
                  <link rel="stylesheet" type="text/css"
                  href="http://ajax.aspnetcdn.com/ajax/jquery.ui/1.11.1/themes/start/jquery-ui.css" media="screen"/>

                  <style>
                    .checkbox {
                        margin-top: -5px;
                    }
                </style>
            {% endblock %}
            {% block javascript %}
                <script src="{{ asset('/bundles/jariffproject/frontend/js-old/bootstrap/bootstrap.js') }}"
                type="text/javascript"></script>
                <script src="{{ asset('/bundles/jariffproject/frontend/js-old/bootstrap/jquery.floatThead.js') }}"></script>
                <script src="{{ asset('bundles/fosjsrouting/js/router.js') }}"></script>
                <script src="{{ path('fos_js_routing_js', {"callback": "fos.Router.setData"}) }}"></script>
                <script src="{{ asset('/bundles/jariffproject/frontend/jqgrid/js/i18n/grid.locale-en.js') }}"></script>
                <script src="{{ asset('/bundles/jariffproject/frontend/jqgrid/js/jquery.jqGrid.min.js') }}"></script>
                <script src="http://ajax.aspnetcdn.com/ajax/jquery.ui/1.10.4/jquery-ui.min.js" type="text/javascript"></script>
                <script src="{{ asset('/bundles/jariffproject/frontend/jqgrid/plugins/ui.multiselect.js') }}"></script>

                <script>
        //        $.jgrid.defaults.width = 1137;
    </script>

    <script type="text/javascript">



        var $collectionHolder;

        //        $('.j-show').children('div').addClass('form-group');

        // setup an "add a tag" link
        var $addFilterLink = $('<div style="clear: both"><br/></div><div class="form-group"><div class="col-md-2">' +
            ' <a href="#" class="add_filter_link btn btn-info">Add Criteria <span class="glyphicon glyphicon-circle-arrow-down" aria-hidden="true"></span></a></div></div><div style="clear: both"></div>');
        var $newLinkLi = $('<div></div>').append($addFilterLink);

        jQuery(document).ready(function () {
            // Get the ul that holds the collection of tags
            $collectionHolder = $('div.j-show');

            // add a delete link to all of the existing tag form li elements
            $collectionHolder.find('div.j-add-filter').each(function () {
                if ($(this).length > 1) {
                    addTagFormDeleteLink($(this));
                }
            });

            // add the "add a tag" anchor and li to the tags ul
            $collectionHolder.append($newLinkLi);

            // count the current form inputs we have (e.g. 2), use that as the new
            // index when inserting a new item (e.g. 2)
            $collectionHolder.data('index', $collectionHolder.find(':input').length);

            $addFilterLink.on('click', function (e) {
                // prevent the link from creating a "#" on the URL
                e.preventDefault();

                var check = $('h5.show');

                if (check.length == 1) {
                    $("#dialog-message").dialog({
                        modal: true
                    });
                    return false;
                }

                // add a new tag form (see next code block)
                addTagForm($collectionHolder, $newLinkLi);
            });


        });

function addTagForm($collectionHolder, $newLinkLi) {
            // Get the data-prototype explained earlier
            var prototype = $collectionHolder.data('prototype');

            console.log(prototype);

            // get the new index
            var index = $collectionHolder.data('index');

            // Replace '__name__' in the prototype's HTML to
            // instead be a number based on how many items we have
            var newForm = prototype.replace(/__name__/g, index);

            // increase the index with one for the next item
            $collectionHolder.data('index', index + 1);

            // Display the form in the page in an li, before the "Add a tag" link li
            var $newFormLi = $('<div><div style="clear: both"></div></div> ').append(newForm);
            $newLinkLi.before($newFormLi);

            // add a delete link to the new form
            addTagFormDeleteLink($newFormLi);
        }

        function addTagFormDeleteLink($tagFormLi) {
            var $removeFormA = $('<div class="form-group">' +
                '<div class="col-md-1">' +
                '<a href="#" class="j-different-remove btn btn-danger" style="font-size: 16px;"' +
                'title="Delete This Filter"> <span class="glyphicon glyphicon-remove" aria-hidden="true"' +
                '></span> remove </a>' +
                '</div>' +
                '</div>');
            $tagFormLi.append($removeFormA);

            $removeFormA.on('click', function (e) {
                // prevent the link from creating a "#" on the URL
                e.preventDefault();

                // remove the li for the tag form
                $tagFormLi.remove();
            });
        }

        $('.j-different-remove-shows').on('click', function () {
            $(this).parent('.col-md-1').parent('.form-group').parent('.j-is-remove').remove();
        })


        $("table.table").floatThead();


        $('.j-popover-q').popover({
            html: true,
            content: function () {
                return $('#popover_content_wrapper').html();
            }
        });

        $('.j-popover-q').on('click', function () {
            $('.j-data-q').html($(this).html());
        })

    </script>

    <script type="text/javascript">
        $('.j-modal-company-one-shipments').on('click', function () {
            var nameCompany = $(this).attr('data-whatever');
            $.ajax({
                type: 'GET',
                url: $(this).attr('data-url'),
                beforeSend: function () {
                    $('.st-content').html('<div class="css3-spinner">' +
                        '<div class="css3-spinner-bounce1"></div>' +
                        '<div class="css3-spinner-bounce2"></div>' +
                        '<div class="css3-spinner-bounce3"></div>' +
                        '</div>'
                        );
                },
                success: function (data) {
                    var res = JSON.parse(data);

                    if (res.success) {
                        $('.j-modal-title').html(nameCompany);
                        $('.show-shipments-one').html(res.html_string);
                    }
                }
            })
        })

        $('.j-modal-save').on('click', function () {
            $.ajax({
                type: 'GET',
                url: '{{ path('member_display_modal_save_shipments',{'slug_country_subscription':'uy-exports','s_cache' : app.request.get('s_cache')}) }}',
                beforeSend: function () {
                    $('.st-content').html('<div class="modal-body" style="min-height:120px"><div class="css3-spinner">' +
                        '<div class="css3-spinner-bounce1"></div>' +
                        '<div class="css3-spinner-bounce2"></div>' +
                        '<div class="css3-spinner-bounce3"></div>' +
                        '</div></div>'
                        );
                },
                success: function (data) {
                    var res = JSON.parse(data);

                    if (res.success) {
                        $('.st-content').html(res.html_string);

                    }
                }
            })
        })

        {#$('.j-modal-field').on('click', function () {#}
            {#$.ajax({#}
                {#type: 'GET',#}
                {#url: '{{ path('member_search_columns_category_columns_show_ec_exports',{'s_cache' : app.request.get('s_cache')}) }}',#}
                {#beforeSend: function () {#}
                {#$('.st-content').html('<div class="css3-spinner">' +#}
                    {#'<div class="css3-spinner-bounce1"></div>' +#}
                    {#'<div class="css3-spinner-bounce2"></div>' +#}
                    {#'<div class="css3-spinner-bounce3"></div>' +#}
                    {#'</div>'#}
                    {#);#}
{#},#}
{#success: function (data) {#}
{#var res = JSON.parse(data);#}

{#if (res.success) {#}
{#$('.st-content').html(res.html_string);#}
{#}#}
{#}#}
{#})#}
{#})#}

$('.j-modal-exports').on('click', function () {
    $.ajax({
        type: 'GET',
        url: '{{ path('member_display_modal_exports_shipments',{'collection':'uy-exports','s_cache' : app.request.get('s_cache')}) }}',
        beforeSend: function () {
            $('.st-content').html('<div class="modal-body" style="min-height:120px"><div class="css3-spinner">' +
                '<div class="css3-spinner-bounce1"></div>' +
                '<div class="css3-spinner-bounce2"></div>' +
                '<div class="css3-spinner-bounce3"></div>' +
                '</div></div>'
                );
        },
        success: function (data) {
            var res = JSON.parse(data);

            if (res.success) {
                $('.st-content').html(res.html_string);
            }
        }
    })
})

$('.pagination li a').on('click', function () {

    $.ajax({
        type: 'GET',
        url: $(this).attr('href'),
        beforeSend: function () {
            $('#page').html('<div style="text-align: center">' +
                '<img src="/bundles/jariffproject/frontend/images/301.GIF">' +
                '<h5 style="margin-top: 15px">Loading...</h5>' +
                '</div>'
                )
            ;
        },
        success: function (data) {
            var res = JSON.parse(data);

            if (res.success) {

                $('#page').html(res.html_string);
                window.history.pushState("object or string", "Title", res.url_changes);


            }

        }
    });

    return false;

})

$('.j-choice-country').on("change", function () {

    var company_as = $(".j-choice-as").val();
    var country = $(this).val();

    $.ajax({
        type: 'POST',
        url: Routing.generate('member_search_shipments_' + country + '_' + company_as + '_field'),
        data: $('.j-form-change').children("form").serialize(),
        beforeSend: function () {
            $('#modalLoadingClick').children('.modal-dialog').html('<div id="chart_div">' +
                '<div class="modal-body" style="height: 100px">' +
                '<div class="css3-spinner">' +
                '<div class="css3-spinner-bounce1"></div>' +
                '<div class="css3-spinner-bounce2"></div>' +
                '<div class="css3-spinner-bounce3"></div>' +
                '</div>' +
                '</div>' +
                '</div>');

            $('#modalLoadingClick').modal('show');
        },
        success: function (data) {
            var res = JSON.parse(data);
            var letterCode;
            if (res.success) {
                $('.j-form-change').html(res.html_string);

                var countryOption = $(".j-choice-country").children('option');
                countryOption.removeAttr('disabled');
                for (letterCode in res.country_list) {
                    for (var i = 0; i < countryOption.length; i++) {
                        if (countryOption.eq(i).val() == letterCode) {
                            countryOption.eq(i).attr('disabled', 'disabled');
                        }

                            // if (countryOption.eq(i).val() == res.selected) {
                            //     countryOption.eq(i).attr('selected', 'selected');
                            // }
                        }

                    }
                    $('#modalLoadingClick').modal('hide');
                } else {
                    $('#modalLoadingClick').children('.modal-dialog').html(res.html_string);
                    $('.j-form-change').html(res.html_callback);
                }


            }
        })
})

$('.j-choice-as').on("change", function () {

    var company_as = $(this).val();
    var country = $('.j-choice-country').val();

    $.ajax({
        type: 'POST',
        url: Routing.generate('member_search_shipments_' + country + '_' + company_as + '_field'),
        data: $('.j-form-change').children("form").serialize(),
        beforeSend: function () {
            $('#modalLoadingClick').children('.modal-dialog').html('<div id="chart_div">' +
                '<div class="modal-body" style="height: 100px">' +
                '<div class="css3-spinner">' +
                '<div class="css3-spinner-bounce1"></div>' +
                '<div class="css3-spinner-bounce2"></div>' +
                '<div class="css3-spinner-bounce3"></div>' +
                '</div>' +
                '</div>' +
                '</div>');

            $('#modalLoadingClick').modal('show');
        },
        success: function (data) {
            var res = JSON.parse(data);
            var letterCode;
            if (res.success) {
                $('.j-form-change').html(res.html_string);

                var countryOption = $(".j-choice-country").children('option');
                countryOption.removeAttr('disabled');
                for (letterCode in res.country_list) {
                    for (var i = 0; i < countryOption.length; i++) {
                        if (countryOption.eq(i).val() == letterCode) {
                            countryOption.eq(i).attr('disabled', 'disabled');
                        }

                        // if (countryOption.eq(i).val() == res.selected) {
                        //     countryOption.eq(i).attr('selected', 'selected');
                        // }
                    }

                }
                $('#modalLoadingClick').modal('hide');
            } else {
                $('#modalLoadingClick').children('.modal-dialog').html(res.html_string);
                $('.j-form-change').html(res.html_callback);
            }


        }
    })
})

function runLoad() {
    var country = $(".j-choice-country").children('option');

    $.ajax({
        type: 'POST',
        url: Routing.generate('member_search_shipments_updating_field'),
        data: $('.j-form-change').children("form").serialize(),
        success: function (data) {
            var res = JSON.parse(data);
            var letterCode;
            if (res.success) {

                for (letterCode in res.country_list) {
                    for (var i = 0; i < country.length; i++) {
                        if (country.eq(i).val() == letterCode) {
                            country.eq(i).attr('disabled', 'disabled');
                        }
                    }

                }
            }
        }
    })
}

$('#modalIntervalMonth').on('click', function () {

    $(this).modal('hide');
    $('.modal-backdrop').remove();
})

</script>

<script type="text/javascript">

    var checkout = $('#demo_search_date_to').datepicker({
        dateFormat: 'yy-mm-dd',
        maxDate: new Date(),
        numberOfMonths: 1,
        minDate: "-{{ app.getUser.getLastSubscription.getHistoryValue }}m",
        onClose: function (selectedDate) {
            $("#demo_search_date_from").datepicker("option", "maxDate", selectedDate);
        }
    }
    );
    var chk_in = $('#demo_search_date_from').datepicker({
        dateFormat: 'yy-mm-dd',
        maxDate: new Date(),
        numberOfMonths: 1,
        minDate: "-{{ app.getUser.getLastSubscription.getHistoryValue }}m",
        onClose: function (selectedDate) {
            $("#demo_search_date_to").datepicker("option", "minDate", selectedDate);
        }
    });




</script>

{% if formDateRange.vars.value.not_valid_date %}
    <script type="text/javascript">




    </script>
{% endif %}

<script type="text/javascript">
    $(document).ready(function () {

            // $('.j-form-change').hide();

            $("#jqGrid").jqGrid({
                url: '{{ path('member_search_shipments_result_uy_exports_ajax_jsonp',{'s_cache' : app.request.get('s_cache')}) }}',
                mtype: "GET",
                styleUI: 'Bootstrap',
                datatype: "json",
                colModel: [
                { label: ' ', name: 'detail_company', key: true, width: 30},
                {% for col in column %}
                { label: '{{ col|uy_exports_column_view }}', name: '{{ col }}', key: true, width: {{ col|uy_exports_column_style }} },
                {% endfor %}
                ],

                viewrecords: true,
                height: 400,
                autowidth: true,
                rowNum: 20,
                shrinkToFit: false,
                altRows: true,
                pager: "#jqGridPager",
                rowList: [20, 50, 100],
                loadComplete: function (data) {

                    runLoad();


                    if(data.errors){
                     $('#modalLoadingClick').modal('show');
                     $('#modalLoadingClick').children('.modal-dialog').html(data.html_string);
                 }

                 $('.j-total-row').html(data.records_ribuan);
                 $('.j-took').html(data.took);


                 $('.j-modal-company-one-shipments').on('click', function () {
                    var nameCompany = $(this).attr('data-whatever');
                    $.ajax({
                        type: 'GET',
                        url: $(this).attr('data-url'),
                        beforeSend: function () {
                            $('.st-content').html('<div class="css3-spinner">' +
                                '<div class="css3-spinner-bounce1"></div>' +
                                '<div class="css3-spinner-bounce2"></div>' +
                                '<div class="css3-spinner-bounce3"></div>' +
                                '</div>'
                                );
                        },
                        success: function (data) {
                            var res = JSON.parse(data);

                            if (res.success) {
                                $('.modal-header').html('<img src="/bundles/jariffproject/frontend/images/logo.png" alt="stradetegy Logo">'+
                                        '<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>'+
                                            '<h4 class="modal-title j-modal-title" id="myModalLabel">' + nameCompany+'</h4>');
                                $('.show-shipments-one').html(res.html_string);
                            }
                        }
                    })
                })
}
});

$('.j-modal-field-new').on('click', function () {
    jQuery("#jqGrid").jqGrid('columnChooser');
})

$('.j-search-again').on('click', function () {
    if ($('.j-form-change').is(":visible")) {
        $('.j-form-change').hide();
    } else {
        $('.j-form-change').show();
    }

})

window.onload = function () {
    $('.j-popover-q').eq(0).popover('hide');
    $('.j-data-q').html($('.j-popover-q').eq(0).html());
    $('.j-popover-btn').on("click", function () {
        $('.j-popover-q').popover('hide');
    });
}

$(window).resize(function () {
    var outerwidth = $('#page').width();
    $('#gbox_jqGrid').attr("style", "width:" + outerwidth);
    $('#gview_jqGrid').attr("style", "width:" + outerwidth);
    $('.ui-jqgrid-hdiv').attr("style", "width:" + outerwidth);
    $('.ui-jqgrid-bdiv').attr("style", "width:" + outerwidth + ";height: 400px;");
    $('#jqGridPager').attr("style", "width:" + outerwidth);
});

var outerwidth = $('#page').width();
$('#gbox_jqGrid').attr("style", "width:" + outerwidth);
$('#gview_jqGrid').attr("style", "width:" + outerwidth);
$('.ui-jqgrid-hdiv').attr("style", "width:" + outerwidth);
$('.ui-jqgrid-bdiv').attr("style", "width:" + outerwidth + ";height: 400px;");
$('#jqGridPager').attr("style", "width:" + outerwidth);

});

</script>

{#{% for col in column %}#}
{#<th><p style="text-align: center;">{{ col|us_column_view }}#}
{#{% if col|us_column_tooltip %}#}
{#<span data-toggle="tooltip" style="margin-left:5px"#}
{#class="icon-info-sign" data-placement="top"#}
{#title="{{ col|us_column_tooltip }}"></span>#}
{#{% endif %}#}
{#</p></th>#}

{#{% endfor %}#}


{% endblock %}
